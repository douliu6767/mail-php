<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>系统设置</title>
    <style>
        body { font-family: Arial, sans-serif; background: transparent; margin: 0; }
        .container { padding: 24px; }
        h2 { font-size: 22px; color: #1976d2; margin-bottom: 18px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: bold; }
        .form-group input { width: 300px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .btn { background: #1976d2; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .btn:hover { background: #1565c0; }
        .msg { margin-top: 12px; padding: 8px; border-radius: 4px; }
        .msg.success { background: #e8f5e8; color: #2e7d32; border: 1px solid #c8e6c9; }
        .msg.error { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h2>系统设置</h2>
    
    <div class="section">
        <h3>修改管理员密码</h3>
        <div class="form-group">
            <label for="old_password">当前密码:</label>
            <input type="password" id="old_password" placeholder="请输入当前密码">
        </div>
        <div class="form-group">
            <label for="new_password">新密码:</label>
            <input type="password" id="new_password" placeholder="请输入新密码">
        </div>
        <div class="form-group">
            <label for="confirm_password">确认新密码:</label>
            <input type="password" id="confirm_password" placeholder="请再次输入新密码">
        </div>
        <button class="btn" onclick="changePassword()">修改密码</button>
        <div class="msg" id="passwordMsg" style="display:none;"></div>
    </div>
</div>

<script>
function changePassword() {
    const oldPassword = document.getElementById('old_password').value;
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const msgDiv = document.getElementById('passwordMsg');
    
    // 清空之前的消息
    msgDiv.style.display = 'none';
    msgDiv.className = 'msg';
    
    // 验证输入
    if (!oldPassword || !newPassword || !confirmPassword) {
        showMessage('请填写所有字段', 'error');
        return;
    }
    
    if (newPassword !== confirmPassword) {
        showMessage('新密码两次输入不一致', 'error');
        return;
    }
    
    if (newPassword.length < 3) {
        showMessage('新密码长度不能少于3位', 'error');
        return;
    }
    
    // 发送请求
    fetch('../api.php?action=change_admin_password', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `old_password=${encodeURIComponent(oldPassword)}&new_password=${encodeURIComponent(newPassword)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showMessage(data.msg || '密码修改成功', 'success');
            // 清空表单
            document.getElementById('old_password').value = '';
            document.getElementById('new_password').value = '';
            document.getElementById('confirm_password').value = '';
        } else {
            showMessage(data.msg || '密码修改失败', 'error');
        }
    })
    .catch(error => {
        showMessage('网络错误，请重试', 'error');
    });
}

function showMessage(message, type) {
    const msgDiv = document.getElementById('passwordMsg');
    msgDiv.textContent = message;
    msgDiv.className = `msg ${type}`;
    msgDiv.style.display = 'block';
}
</script>
</body>
</html>

